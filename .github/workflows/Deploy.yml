name: Build, Deploy to Staging, E2E Test, and Slot Swap - BPCalc

on:
  workflow_run:
    workflows: ["OWASP Dependency Checker"]
    types:
      - completed

env:
  APP_NAME: "BPCalc"
  RESOURCE_GROUP: "CSD"
  STAGING_SLOT: "staging"

  # Use your real regional hostnames
  STAGING_URL: "https://bpcalc-staging-bgftgdg0g0a5f5cx.francecentral-01.azurewebsites.net"
  PROD_URL: "https://bpcalc-dqdzd2c5e9h0cvg3.francecentral-01.azurewebsites.net"

  # Simple UI marker to validate the app loaded
  EXPECTED_TEXT: "BP Category Calculator"

jobs:
  build:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: windows-latest
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up .NET 9
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: "9.x"

      - name: Res
